_This guide describes the steps required to have the Pydio Cells Docker container running._

[:image-popup:1_installation_guides/logos-os/logo-docker.png]

### How to use the Pydio Cells docker image

The Pydio cells image is designed to be used in a micro-service environment. It only contains what is strictly necessary to run the Pydio Cells binary and nothing more.

In order to have a fully working Pydio Cells environment, you need to run a database (MySQL or MariaDB) and a PHP-FPM (to handle the frontend) on the same network. A basic setup is described on this page.

#### Using the image

```sh
docker run -d -p 8080:8080 pydio/cells
```

You can now access the Pydio Cells installer at https://localhost:8080

#### External database

Pydio Cells requires a MySQL or MariaDB database. It is recommended to use a separate database and a dedicated user with access to that database. A basic configuration can be found in the docker-compose section of this guide.

#### External PHP-FPM

Pydio Cells requires a PHP-FPM process. The frontend files generated by the installer must be made available to the PHP-FPM. A basic configuration can be found in the docker-compose section of the guide.

Note: Pydio Cells uses php extensions functionalities that are not available by default in the official php-fpm containers. We provide a container based on the php:fpm-alpine

```sh
docker run -d -p 9000:9000 pydio/cells-php
```

If you prefer to use another version of the php-fpm container, you may still do so, but please bear in mind that some functionalities might be missing. Refer to the [Pydio Cells PHP container dockerfile](https://github.com/pydio/cells/blob/master/tools/docker/cells-php/Dockerfile) to ensure you install everything that is needed by the application 

#### Persistent data

All default configuration and data (`/root/.config` on the container) is saved in an unnamed volume.

If you want to use named volumes, here is an overview of the important files :

- `/root/.config/pydio/cells/pydio.json` : main configuration file
- `/root/.config/pydio/cells/data` : data
- `/root/.config/pydio/cells/logs` : logs
- `/root/.config/pydio/cells/services` : services information
- `/root/.config/pydio/cells/static` : static frontend files

Note: If you [add new datasources](https://pydio.com/fr/docs/cells/v1/managing-datasources) and want to persist the data, ensure that their location is also mounted in a volume.

#### Environment variable

The Pydio Cells docker image uses two environment variables to define the url internal to the application and the url external to the application

- `CELLS_BIND` : internal url - used by services to talk between each others
- `CELLS_EXTERNAL` : external url - used in links, etc..

Note : CELLS_BIND and CELLS_EXTERNAL can only use different ports at the time of writing. They must share the same host.

### Example setup with docker compose

```sh
version: '3'
services:

    # Cells image with two named volumes for the static and for the data
    cells:
        image: cells:latest
        restart: always
        volumes: ["static:/root/.config/pydio/cells/static/pydio", "data:/root/.config/pydio/cells/data"]
        ports: ["8080:8080"]
        environment:
            - CELLS_BIND=demo.pydio.com:8080
            - CELLS_EXTERNAL=demo.pydio.com
        network_mode: "host"

    # MySQL image with a default database cells and a dedicated user pydio
    mysql:
         image: mysql:5.7
         restart: always
         environment:
             MYSQL_ROOT_PASSWORD: P@ssw0rd
             MYSQL_DATABASE: cells
             MYSQL_USER: pydio
             MYSQL_PASSWORD: P@ssw0rd
         command: [mysqld, --character-set-server=utf8mb4, --collation-server=utf8mb4_unicode_ci]
         ports: ["3306:3306"]
         network_mode: "host"

    # PHP FPM image with the static named volume from the cells container
    php:
        image: cells-php:latest
        restart: always
        volumes: ["static:/root/.config/pydio/cells/static/pydio"]
        network_mode: "host"

volumes:
    static: {}
    data: {}
```

Note : We use network mode host to facilitate the setup. This option is not available on MacOS X and the cells_bind variable must always be the name of the service (in our case cells) in order for the setup to work.

### Public access

#### HTTPS

We recommend you [run behind a proxy](https://pydio.com/fr/docs/cells/v1/run-behind-proxy) to encrypt the content you want to publish over the internet.

The [nginx-proxy](https://github.com/jwilder/nginx-proxy) and [docker-letsencrypt-nginx-proxy-companion](https://github.com/JrCs/docker-letsencrypt-nginx-proxy-companion) containers can also be used to setup your proxy.
